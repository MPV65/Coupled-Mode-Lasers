
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>runCoupled1D</title><meta name="generator" content="MATLAB 9.8"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-04-16"><meta name="DC.source" content="runCoupled1D.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#4">Description</a></li><li><a href="#5">Usage</a></li><li><a href="#6">Arguments</a></li><li><a href="#7">Returns</a></li><li><a href="#8">Dependencies</a></li></ul></div><p><b>RUNCOUPLED1D</b></p><h2 id="4">Description</h2><p>Runs the temporal evolution of the coupled mode model dynamics for a twin cavity. The routine calls 'coupled1D', which implements the rate equations for the model given in [1].</p><p>[1] M.J. Adams et al, Phys. Rev. A 95(5), 053869 (2017)</p><h2 id="5">Usage</h2><pre class="language-matlab">[tout, Nout] = runCoupled1D(tsim, QA, QB, d, DW, param, varargin)
</pre><h2 id="6">Arguments</h2><pre class="language-matlab">tsim        <span class="string">integer</span> <span class="string">specifying</span> <span class="string">the</span> <span class="string">simulation</span> <span class="string">time</span> <span class="string">tspan</span> <span class="string">via</span> <span class="string">tspan</span> <span class="string">=</span>
            tsim/yn, where <span class="string">yn</span> <span class="string">is</span> <span class="string">the</span> <span class="string">recombination</span> <span class="string">rate</span> <span class="string">(in 1/ns)</span>
</pre><pre class="language-matlab">QA          <span class="string">Pump</span> <span class="string">power</span> <span class="string">in</span> <span class="string">guide</span> <span class="string">(1)</span>
</pre><pre class="language-matlab">QB          <span class="string">Pump</span> <span class="string">power</span> <span class="string">in</span> <span class="string">guide</span> <span class="string">(2)</span>
</pre><pre class="language-matlab">d           <span class="string">distance</span> <span class="string">between</span> <span class="string">guides</span> <span class="string">(microns)</span>
</pre><pre class="language-matlab">DW          <span class="string">frequency</span> <span class="string">detuning</span> <span class="string">(rad/ns)</span>
</pre><pre class="language-matlab">param       <span class="string">structure</span> <span class="string">containing</span> <span class="string">laser</span> <span class="string">parameters:</span>
</pre><pre>             param.aH    Linewidth enhancement factor
             param.k0    free space wavevector (1/micron)
             param.kp    1/(2*tau_p) - cavity loss rate (1/ns)
             param.n1    core refractive index
             param.n2    cladding refractive index
             param.w     guide width (micron)
             param.yn    1/(tau_N) - carrier recombination rate (1/ns)</pre><pre class="language-matlab">varargin    <span class="string">optional</span> <span class="string">values:</span>
</pre><pre>                 opt(1)  a numeric value. If greater than zero, the
                         graphs are plotted
                 opt(2)  a 5 x 1 array containing initial values:</pre><pre>                     N0(1)   Carrier concentration in guide A
                     N0(2)   Carrier concentration in guide B
                     N0(3)   Optical amplitude in guide A
                     N0(4)   Optical amplitude in guide B
                     N0(5)   Relative phase between fields in A and B</pre><h2 id="7">Returns</h2><pre class="language-matlab">Nout        <span class="string">4001</span> <span class="string">x</span> <span class="string">5</span> <span class="string">array</span> <span class="string">containing</span> <span class="string">the</span> <span class="string">time</span> <span class="string">evolution</span> <span class="string">of</span> <span class="string">variables</span>
</pre><pre>                 Nout(:,1)   Carrier concentration in guide A
                 Nout(:,2)   Carrier concentration in guide B
                 Nout(:,3)   Optical amplitude in guide A
                 Nout(:,4)   Optical amplitude in guide B
                 Nout(:,5)   Relative phase between fields in A and B</pre><pre class="language-matlab">tout        <span class="string">4001</span> <span class="string">x</span> <span class="string">1</span> <span class="string">array</span> <span class="string">of</span> <span class="string">corresponding</span> <span class="string">time</span> <span class="string">values</span>
</pre><h2 id="8">Dependencies</h2><pre class="language-matlab">This <span class="string">routine</span> <span class="string">calls:</span>
</pre><pre>     &lt;singleSlab.html singleSlab&gt; - calculates the coupling coefficient
     &lt;coupled1D.html coupled1D&gt; - the model rate equations</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020a</a><br></p></div><!--
##### SOURCE BEGIN #####
function [tout, Nout] = runCoupled1D(tsim, QA, QB, d, DW, param, varargin)
% RUNCOUPLED1D Runs the temporal evolution of the coupled guide dynamics 
%%
% *RUNCOUPLED1D*
%
%%  Description
%
% Runs the temporal evolution of the coupled mode model dynamics for a
% twin cavity. The routine calls 'coupled1D', which implements the rate
% equations for the model given in [1].
%
% [1] M.J. Adams et al, Phys. Rev. A 95(5), 053869 (2017)
%
%%  Usage
%
%   [tout, Nout] = runCoupled1D(tsim, QA, QB, d, DW, param, varargin)
%
%%  Arguments
%
%   tsim        integer specifying the simulation time tspan via tspan =
%               tsim/yn, where yn is the recombination rate (in 1/ns) 
%
%   QA          Pump power in guide (1)
%
%   QB          Pump power in guide (2)
%
%   d           distance between guides (microns)
%
%   DW          frequency detuning (rad/ns)
%
%   param       structure containing laser parameters:
%
%               param.aH    Linewidth enhancement factor
%               param.k0    free space wavevector (1/micron)
%               param.kp    1/(2*tau_p) - cavity loss rate (1/ns)
%               param.n1    core refractive index 
%               param.n2    cladding refractive index
%               param.w     guide width (micron)
%               param.yn    1/(tau_N) - carrier recombination rate (1/ns)
%
%   varargin    optional values:
%
%                   opt(1)  a numeric value. If greater than zero, the
%                           graphs are plotted
%                   opt(2)  a 5 x 1 array containing initial values:
%
%                       N0(1)   Carrier concentration in guide A
%                       N0(2)   Carrier concentration in guide B
%                       N0(3)   Optical amplitude in guide A
%                       N0(4)   Optical amplitude in guide B
%                       N0(5)   Relative phase between fields in A and B
%
%%  Returns
% 
%   Nout        4001 x 5 array containing the time evolution of variables
%
%                   Nout(:,1)   Carrier concentration in guide A
%                   Nout(:,2)   Carrier concentration in guide B
%                   Nout(:,3)   Optical amplitude in guide A
%                   Nout(:,4)   Optical amplitude in guide B
%                   Nout(:,5)   Relative phase between fields in A and B
%
%   tout        4001 x 1 array of corresponding time values
%
%%  Dependencies
%
%   This routine calls:
%
%       <singleSlab.html singleSlab> - calculates the coupling coefficient
%       <coupled1D.html coupled1D> - the model rate equations
%
%%

    % Flag to plot graphs
    plotgraphs = false;
    no_initial = true;

    % Check for flag to plot graphs
    if (nargin > 6)

        if (varargin{1} > 0)
            
            plotgraphs = true;
            
        end

    end
    
    % Check for intial values
    if (nargin > 7)

        N0 = varargin{2};
        
        sz = size(N0);
        
        if ((sz(1) ~= 5)||(sz(2)~=1))
            
            error('Initial values are not given in a 5 x 1 array')
            
        end
        
        no_initial = false;

    end

    if (QA < 0)
        error('eta1 cannot be negative')
    end

    if (QB < 0)
        error('eta2 cannot be negative')
    end

    % Extract waveguide parameters
    k0 = param.k0;
    n1 = param.n1;
    n2 = param.n2;
    w = param.w;

    % Find coupling coefficient
    [~, eta, ~, ~] = singleSlab(k0, n1, n2, w, d);

    % Set additional required parameters
    param.eta = abs(eta);
    param.QA = QA;
    param.QB = QB;
    param.DW = DW;
    param.theta = angle(eta);

    % Set local variables to report
    yn = param.yn;
    kp = param.kp;
    aH = param.aH;
    theta = param.theta;

    runstr = ['Coupled cavity model: d/a = ' num2str(d/w)]; 

    % Output parameters 
    disp(' ');
    disp(datestr(now));
    disp(' ');
    disp(runstr);
    disp(' ');
    disp('Guide parameters:');
    disp(['k0 = ' num2str(k0) ' - free-space wavevector (rad/micron)']);
    disp(['n1 = ' num2str(n1) ' - refractive index in guides']);
    disp(['n2 = ' num2str(n2) ' - refractive index outside guides']);
    disp(['d = ' num2str(d) ' - distance between guides (microns)']);
    disp(['w = ' num2str(w) ' - width of guides (microns)']);
    disp(['|eta| = ' num2str(eta) ' - coupling coefficient (modulus)']);
    disp(['theta = ' num2str(theta) ' - coupling coefficient (argument)']);
    disp(['DW = ' num2str(DW) ' - frequency detuning']);

    disp(' ');
    disp('General parameters:');
    disp(['kp = ' num2str(kp) ' - the cavity loss rate (ns^-1)']);
    disp(['aH = ' num2str(aH) ' - linewidth enhancement factor']); 
    disp(['yn = ' num2str(yn) ' - recombination rate (ns^-1)']);
    disp(' ');
    disp('Individual guide parameters:');
    disp(['QA = ' num2str(QA) ' - total pump power in guide (1)']);   
    disp(['QB = ' num2str(QB) ' - total pump power in guide (2)']);
    disp(' '); 
    disp(['Simulation time = ' num2str(tsim) '/yn = ' num2str(tsim/yn) ' ns']);

    if (no_initial)
        % Set default initial conditions
        N0 = zeros(5,1);
        %
        %   Carrier concentrations:
        %       MA = N0(1);         % Carrier concentration in guide A
        %       MB = N0(2);         % Carrier concentration in guide A
        %   Optical fields:
        %       YA = N0(3);         % Amplitude in guide A
        %       YB = N0(4);         % Amplitude in guide B
        %       phi = N0(5);        % Relative phase between fields in A and B

        MA = 0.0;   % Guide 1
        MB = 0.0;   % Guide 2

        % Steady state solutions
        % dM = 0.000001;
        % MS = 1.0;
        % MA = MS + dM;   % Guide 1
        % MB = MS + dM;   % Guide 2

        IA = 1E-4;          % Initial signal power symmetric mode 
        IB = 1E-4;          % Initial signal power anti-symmetric mode 
        YA = sqrt(IA);      % symmetric component of light 
        YB = sqrt(IB);      % anti-symmetric component of light 

        % Steady state solutions
        % dA = 0.000001;
        % YAS = real(sqrt(QA - 1));
        % YBS = real(sqrt(QB - 1));
        % YA = YAS + dA;   % Guide 1
        % YB = YBS + dA;   % Guide 2

        phi = 0.001;        % Phase 

        N0(1) = MA;         % Carrier concentration in guide A
        N0(2) = MB;         % Carrier concentration in guide B
        N0(3) = YA;     	% Amplitude in guide A
        N0(4) = YB;     	% Amplitude in guide B
        N0(5) = phi;        % Relative phase between fields in A and B
        
    end

    % Time span (yn = 1/tau, where tau is the lifetime)
    maxt = tsim/yn;
    mint = 0.0;
    npts = 4001; 
    dt = (maxt - mint)/(npts - 1.0);

    tspan = mint:dt:maxt;

    odefun = @(t, N) coupled1D(t, N, param); % Anonymous handle to function

    reltol = 1E-6;
    options = odeset('RelTol', reltol);

    % Runge-Kutta implementation
    [tout, Nout] = ode45(odefun, tspan, N0, options);    

    % Output values
    MAt = Nout(:,1);
    MBt = Nout(:,2);
    YAt = Nout(:,3);
    YBt = Nout(:,4);
    phit = Nout(:,5);

    % Test derivatives at end of calculation
    Nt = transpose(Nout(end,:));
    dN = coupled1D(maxt, Nt, param);

    dMAdt = dN(1);
    dMBdt = dN(2);
    dYAdt = dN(3);
    dYBdt = dN(4);
    dphidt = dN(5);

    % Output results
    disp(' ');
    disp('At end of simulation:');
    disp(['N(1) = ' num2str(MAt(end))]);
    disp(['N(2) = ' num2str(MBt(end))]);
    disp(['A_{1} = ' num2str(YAt(end))]);
    disp(['A_{2} = ' num2str(YBt(end))]);
    disp(['phi = ' num2str(phit(end))]);
    disp(' ');

    disp('Derivatives:');
    disp(['dN1/dt = ' num2str(dMAdt)]);
    disp(['dN2/dt = ' num2str(dMBdt)]);
    disp(['dA1/dt = ' num2str(dYAdt)]);
    disp(['dA2/dt = ' num2str(dYBdt)]);
    disp(['dphi/dt = ' num2str(dphidt)]);


	if plotgraphs

        % Plot solution
        lw = 1.5; % linewidth

        % Plot carriers 
        figure;
        hold on;
        plot(tout, MAt, 'LineWidth', lw);
        plot(tout, MBt, 'LineWidth', lw);
        title(['Carriers: QA = ' num2str(QA) ', QB = ' num2str(QB) ' (coupled)']);
        ylabel('Carrier concentration');
        xlabel('Simulation time (1/\gamma)');
        legend('N^{(1)}', 'N^{(2)}');
        grid on;

        IA = YAt.*YAt;
        IB = YBt.*YBt;

        % Plot intensities
        figure;
        hold on;
        plot(tout, IA, 'LineWidth', lw);
        plot(tout, IB, 'LineWidth', lw);
        title(['Intensities: QA = ' num2str(QA) ', QB = ' num2str(QB) ' (coupled)']);

        ylabel('Optical intensity');
        xlabel('Simulation time (1/\gamma)');
        legend('I_{1}','I_{2}');
        grid on;

        % Plot phase
        figure;
        hold on;
        plot(tout, phit, 'LineWidth', lw);
        title(['Phase: eta1 = ' num2str(QA) ', eta2 = ' num2str(QB)]);
        ylabel('Relative phase');
        xlabel('Simulation time (1/\gamma)');
        %ylim([-2*pi 2*pi]);
        grid on;

	end

end







##### SOURCE END #####
--></body></html>